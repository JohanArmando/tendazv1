{"version":3,"sources":["User.js","Cart.js","Coupon.js","Email.js","Profile.js","Shipping.js","Payment.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"models.js","sourcesContent":["myApp.factory('User' ,['$http', '$location', '$cookies' , \"$rootScope\" , \"Cart\",  function ($http , $location , $cookies , $rootScope , Cart) {\r\n    var userModel = {};\r\n\r\n    userModel.doLogin = function (data) {\r\n        var cartId = localStorage.getItem('cart_id') ? '/'+localStorage.getItem('cart_id') : '';\r\n        return $http({\r\n            headers: {\r\n                'Accept': 'application/json',\r\n                'Content-Type': 'application/json'\r\n            },\r\n            url: baseUrl + '/auth/login'+ cartId +'?client_secret='  + client_secret + '&client_id=' + client_id,\r\n            method: \"POST\",\r\n            data: {\r\n                email: data.email,\r\n                password: data.password\r\n            }\r\n        }).then(function(response) {\r\n            $location.path('/cart');\r\n            $cookies.put('auth' , JSON.stringify(response.data));\r\n            Cart.setCartId(response.data.cart_id);\r\n            $('#sign-up').modal('toggle');\r\n            location.reload();\r\n        }).catch(function(response) {\r\n                $('.bg-danger').removeClass('hidden').text(response.data);\r\n        })\r\n    };\r\n    userModel.doRegister = function (data) {\r\n        var cartId = localStorage.getItem('cart_id') ? '/'+localStorage.getItem('cart_id') : '';\r\n        return $http({\r\n            headers: {\r\n                'Accept': 'application/json',\r\n                'Content-Type': 'application/json'\r\n            },\r\n            url: baseUrl + '/auth/register' + cartId     + '?client_secret='  + client_secret + '&client_id=' + client_id,\r\n            method: \"POST\",\r\n            data: data,\r\n        }).then(function(response) {\r\n            $location.path('/cart');\r\n            $cookies.put('auth' , JSON.stringify(response.data));\r\n            Cart.setCartId(response.data.cart_id);\r\n            $('#sign-up').modal('toggle');\r\n            location.reload();\r\n        }).catch(function(response) {\r\n            var danger = $('.bg-danger');\r\n            danger.removeClass('hidden');\r\n            danger.html(\"<ul></ul>\");\r\n            angular.forEach(response.data , function (value , index) {\r\n                danger.find(\"ul\").append(\"<li>\" + value + \"</li>\");\r\n            });\r\n        }).finally(function() {});  \r\n    };\r\n    userModel.getAuthStatus = function() {\r\n        var status = $cookies.get('auth');\r\n        if (status) {\r\n            return true;\r\n        } else {\r\n            return false;\r\n        }\r\n    };\r\n\r\n    userModel.getUserObject = function () {\r\n        var usrObject = angular.fromJson($cookies.get('auth'));\r\n        return usrObject;\r\n    };\r\n\r\n    userModel.doUserLogout = function () {\r\n        $cookies.remove('auth');\r\n    };\r\n    \r\n    userModel.doEmail = function (email) {\r\n        return $http({\r\n            headers: {\r\n                'Accept': 'application/json',\r\n                'Content-Type': 'application/json'\r\n            },\r\n            url: baseUrl + '/auth/email/' + email + '/' + Cart.getCartId() + '/?client_secret='  + client_secret + '&client_id=' + client_id,\r\n            method: \"GET\",\r\n        }).then(function(response) {\r\n            $rootScope.carts = response.data.data;\r\n            $location.path('/profile');\r\n        }).catch(function(response) {\r\n            console.log(response);\r\n        }).finally(function() {});\r\n    };\r\n    \r\n    userModel.getUserId = function () {\r\n      if (userModel.getUserObject()){\r\n          return userModel.getUserObject()._id;\r\n      }else{\r\n          return Cart.getItems(Cart.getCartId()).data.data.customer.data._id;\r\n      } \r\n    };\r\n    //guardar el customer id en una cookie par evitar una peticion mass\r\n    return userModel;\r\n}]);","myApp.factory(\"Cart\" , [ \"$http\" , \"$rootScope\", function ($http , $rootScope) {\r\n    var cart = [];\r\n    cart.getCartId = function () {\r\n       return localStorage.getItem('cart_id');\r\n    };\r\n\r\n    cart.setCartId = function (cartId) {\r\n        localStorage.setItem('cart_id' , cartId);\r\n    };\r\n\r\n    cart.getItems = function (cartId) {\r\n        if (!cartId){\r\n            return [];\r\n        }\r\n        return $http({\r\n            headers: {\r\n                'Accept': 'application/json',\r\n                'Content-Type': 'application/json'\r\n            },\r\n            url: baseUrl + '/carts/' + cartId + '/items?client_secret='  + client_secret + '&client_id=' + client_id,\r\n            method: \"GET\",\r\n        }).then(function(response) {\r\n           $rootScope.carts = response.data.data;\r\n           $rootScope.shopData = $rootScope.carts.shop.data;\r\n           console.log( $rootScope.shopData);\r\n        }).catch(function(response) {\r\n            console.log(response);\r\n        }).finally(function() {});\r\n    };\r\n\r\n    cart.deleteItem = function (cartId , item) {\r\n        return $http({\r\n            headers: {\r\n                'Accept': 'application/json',\r\n                'Content-Type': 'application/json'\r\n            },\r\n            url: baseUrl + '/carts/'+ cartId +'/items/'+ item._id + '?client_secret=' + client_secret + '&client_id=' +client_id,\r\n            method: \"DELETE\",\r\n        }).then(function(response) {\r\n            var index= $rootScope.carts.products.data.indexOf(item);\r\n            $rootScope.carts.products.data.splice(index,1);\r\n        }).catch(function(response) {\r\n            var index= $rootScope.carts.products.data.indexOf(item);\r\n            $rootScope.carts.products.data.splice(index,1);\r\n        }).finally(function() {});\r\n    };\r\n\r\n    cart.updateItem = function (cartId , item) {\r\n        var data = {\r\n            'item_id'   : item._id,\r\n            'quantity'  : item.quantity\r\n        };\r\n        return $http({\r\n            headers: {\r\n                'Accept': 'application/json',\r\n                'Content-Type': 'application/json'\r\n            },\r\n            url: baseUrl + '/carts/' + cartId + '/items?client_secret=' + client_secret + '&client_id=' +client_id,\r\n            method: \"POST\",\r\n            data : data,\r\n        }).then(function(response) {\r\n            $rootScope.carts = response.data.data;\r\n            console.log(response);\r\n        }).catch(function(response) {\r\n            $rootScope.carts = response.data.data;\r\n            $('.updateItem').animate({\r\n                height: 'toggle'\r\n            }).removeClass('hidden').find('.alert').text('Lo siento no hay suficiente stock para '+ item.name);\r\n            setTimeout(function () {\r\n                $('.updateItem').animate({ height: 'toggle'} , 1000);\r\n            } , 7000)\r\n        }).finally(function() {});\r\n    };\r\n    return cart;\r\n}]);","myApp.factory('Coupon' , [\"$http\" , \"Cart\" , \"$rootScope\", function ($http , Cart , $rootScope) {\r\n    var couponModel = {};\r\n    couponModel.useCoupon = function (couponId) {\r\n        return $http({\r\n            headers: {\r\n                'Accept': 'application/json',\r\n                'Content-Type': 'application/json'\r\n            },\r\n            url: baseUrl + '/carts/' + Cart.getCartId() + '/coupons/' + couponId + '?client_secret='  + client_secret + '&client_id=' + client_id,\r\n            method: \"GET\"\r\n        }).then(function(response) {\r\n            $('#no-coupon').addClass('hidden');\r\n            $('#yes-coupon').removeClass('hidden');\r\n            $rootScope.carts = response.data.data;\r\n        }).catch(function(response) {\r\n            $('#no-coupon').removeClass('hidden');\r\n            $('#yes-coupon').addClass('hidden');\r\n        }).finally(function() {});\r\n    };\r\n    return couponModel;\r\n}]);","myApp.factory('Email' ,['$http', '$location' , \"$rootScope\" , \"Cart\",  function ($http , $location , $rootScope , Cart) {\r\n    var emailModel = {};\r\n    emailModel.doEmail = function (email) {\r\n        return $http({\r\n            headers: {\r\n                'Accept': 'application/json',\r\n                'Content-Type': 'application/json'\r\n            },\r\n            url: baseUrl + '/auth/email/' + email + '/' + Cart.getCartId() + '/?client_secret='  + client_secret + '&client_id=' + client_id,\r\n            method: \"GET\"\r\n        }).then(function(response) {\r\n            $rootScope.carts = response.data.data;\r\n            $location.path('/profile');\r\n        }).catch(function(response) {\r\n            console.log(response);\r\n        }).finally(function() {});\r\n    };\r\n    return emailModel;\r\n}]);","myApp.factory(\"Profile\" , [\"$http\" , \"$rootScope\" , \"$location\" , function ($http , $rootScope , $location) {\r\n    var profileModel = [];\r\n    profileModel.updateData = function (data) {\r\n        return $http({\r\n            headers: {\r\n                'Accept': 'application/json',\r\n                'Content-Type': 'application/json'\r\n            },\r\n            url: baseUrl + '/orders/' + $rootScope.carts.order_id  + '?client_secret='  + client_secret + '&client_id=' + client_id,\r\n            method: \"PUT\",\r\n            data : data\r\n        }).then(function(response) {\r\n            $rootScope.carts = response.data.data;\r\n            $location.path('/shipping');\r\n        }).catch(function(response) {\r\n            console.log(response);\r\n        }).finally(function() {});\r\n    }; \r\n    \r\n    return profileModel;\r\n}]);","myApp.factory(\"Shipping\" , [\"$http\" , \"User\", \"$rootScope\" , \"Cart\", function ($http , User , $rootScope , Cart) {\r\n   var address = {};\r\n\r\n    address.getAddresses = function () {\r\n        return $http({\r\n            headers: {\r\n                'Accept': 'application/json',\r\n                'Content-Type': 'application/json'\r\n            },\r\n            url: baseUrl + '/carts/'+ Cart.getCartId() +'/customers/' + User.getUserId() + '/addresses?client_secret='  + client_secret + '&client_id=' + client_id,\r\n            method: \"GET\",\r\n        }).then(function(response) {\r\n            $rootScope.addresses = response.data.data;\r\n        }).catch(function(response) {\r\n            $rootScope.states = response.data;\r\n        }).finally(function() {});\r\n    };\r\n\r\n    address.getStates = function () {\r\n        return $http({\r\n            headers: {\r\n                'Accept': 'application/json',\r\n                'Content-Type': 'application/json'\r\n            },\r\n            url: baseUrl + '/states?client_secret='  + client_secret + '&client_id=' + client_id,\r\n            method: \"GET\",\r\n        }).then(function(response) {\r\n            $rootScope.states = response.data.states;\r\n        }).catch(function(response) {\r\n            console.log(response);\r\n        }).finally(function() {});\r\n    };\r\n    address.getCities = function (id) {\r\n        return $http({\r\n            headers: {\r\n                'Accept': 'application/json',\r\n                'Content-Type': 'application/json'\r\n            },\r\n            url: baseUrl + '/cities/'+ id +'?client_secret='  + client_secret + '&client_id=' + client_id,\r\n            method: \"GET\",\r\n        }).then(function(response) {\r\n            $rootScope.cities = response.data.cities;\r\n            $rootScope.defaultCity = response.data.cities[0];\r\n        }).catch(function(response) {\r\n            console.log(response);\r\n        }).finally(function() {});\r\n    };\r\n\r\n    address.create = function (data) {\r\n        return $http({\r\n            headers: {\r\n                'Accept': 'application/json',\r\n                'Content-Type': 'application/json'\r\n            },\r\n            url: baseUrl + '/carts/' + Cart.getCartId() +'/customers/' + User.getUserId()  + '/addresses?client_secret='  + client_secret + '&client_id=' + client_id,\r\n            method: \"POST\",\r\n            data : data\r\n        }).then(function(response) {\r\n            $rootScope.addresses = response.data.data;\r\n        }).catch(function(response) {\r\n            console.log(response);\r\n        }).finally(function() {});  \r\n    };\r\n     address.getShippingMethod = function () {\r\n        return $http({\r\n            headers: {\r\n                'Accept': 'application/json',\r\n                'Content-Type': 'application/json'\r\n            },\r\n            url: baseUrl + '/carts/' + Cart.getCartId() +'/shipping?client_secret='  + client_secret + '&client_id=' + client_id,\r\n            method: \"GET\"\r\n        }).then(function(response) {\r\n            $rootScope.shipping_methods = response.data.data;\r\n        }).catch(function(response) {\r\n            console.log(response);\r\n        }).finally(function() {});\r\n    };\r\n\r\n    address.doShippingMethod = function (data) {\r\n        return $http({\r\n            headers: {\r\n                'Accept': 'application/json',\r\n                'Content-Type': 'application/json'\r\n            },\r\n            url:  baseUrl + '/orders/' + $rootScope.carts.order_id  + '?client_secret='  + client_secret + '&client_id=' + client_id,\r\n            method: \"PUT\",\r\n            data : data\r\n        }).then(function(response) {\r\n            $rootScope.carts = response.data.data;\r\n        }).catch(function(response) {\r\n            console.log(response);\r\n        }).finally(function() {});\r\n    };  \r\n    \r\n    address.assignShipping = function (data) {\r\n        return $http({\r\n            headers: {\r\n                'Accept': 'application/json',\r\n                'Content-Type': 'application/json'\r\n            },\r\n            url:  baseUrl + '/orders/' + $rootScope.carts.order_id  + '?client_secret='  + client_secret + '&client_id=' + client_id,\r\n            method: \"PUT\",\r\n            data : data\r\n        }).then(function(response) {\r\n            console.log(response);\r\n            $rootScope.carts = response.data.data;\r\n        }).catch(function(response) {\r\n            console.log(response);\r\n        }).finally(function() {});\r\n    };\r\n\r\n    return address;\r\n}]);","myApp.factory('Payment' ,['$http', '$location' , \"$rootScope\" , \"Cart\",  function ($http , $location , $rootScope , Cart) {\r\n    var paymentModel = {};\r\n    paymentModel.getPaymentMethod = function () {\r\n        return $http({\r\n            headers: {\r\n                'Accept': 'application/json',\r\n                'Content-Type': 'application/json'\r\n            },\r\n            url: baseUrl + '/payments/?client_secret='  + client_secret + '&client_id=' + client_id,\r\n            method: \"GET\"\r\n        }).then(function(response) {\r\n            $rootScope.payment_methods = response.data.data;\r\n        }).catch(function(response) {\r\n            console.log(response);\r\n        }).finally(function() {});\r\n    };  \r\n    \r\n    paymentModel.doPayment = function (method) {\r\n        return $http({\r\n            headers: {\r\n                'Accept': 'application/json',\r\n                'Content-Type': 'application/json'\r\n            },\r\n            url: baseUrl + '/payments' +  method + '/carts/' + Cart.getCartId()  + '?client_secret='  + client_secret + '&client_id=' + client_id,\r\n            method: \"GET\"\r\n        }).then(function(response) {\r\n            if (response.data.url){\r\n                localStorage.removeItem('cart_id');\r\n                $MPC.openCheckout({\r\n                    url: response.data.url,\r\n                    mode: \"modal\",\r\n                    onreturn: function(data) {\r\n                        $location.reload();\r\n                    }\r\n                });\r\n            }\r\n        }).catch(function(response) {\r\n            console.log(response);\r\n        }).finally(function() {});\r\n    };\r\n\r\n    return paymentModel;\r\n}]);"]}