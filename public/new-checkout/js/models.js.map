{"version":3,"sources":["/resources/assets/js/checkout/Models/User.js","/resources/assets/js/checkout/Models/Cart.js","/resources/assets/js/checkout/Models/Coupon.js","/resources/assets/js/checkout/Models/Email.js","/resources/assets/js/checkout/Models/Profile.js","/resources/assets/js/checkout/Models/Shipping.js","/resources/assets/js/checkout/Models/Payment.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"models.js","sourcesContent":["myApp.factory('User' ,['$http', '$location', '$cookies' , \"$rootScope\" , \"Cart\",  function ($http , $location , $cookies , $rootScope , Cart) {\n    var userModel = {};\n\n    userModel.doLogin = function (data) {\n        var cartId = localStorage.getItem('cart_id') ? '/'+localStorage.getItem('cart_id') : '';\n        return $http({\n            headers: {\n                'Accept': 'application/json',\n                'Content-Type': 'application/json'\n            },\n            url: baseUrl + '/auth/login'+ cartId +'?client_secret='  + client_secret + '&client_id=' + client_id,\n            method: \"POST\",\n            data: {\n                email: data.email,\n                password: data.password\n            }\n        }).then(function(response) {\n            $location.path('/cart');\n            $cookies.put('auth' , JSON.stringify(response.data));\n            Cart.setCartId(response.data.cart_id);\n            $('#sign-up').modal('toggle');\n            location.reload();\n        }).catch(function(response) {\n                $('.bg-danger').removeClass('hidden').text(response.data);\n        })\n    };\n\n    userModel.doRegister = function (data) {\n        var cartId = localStorage.getItem('cart_id') ? '/'+localStorage.getItem('cart_id') : '';\n        return $http({\n            headers: {\n                'Accept': 'application/json',\n                'Content-Type': 'application/json'\n            },\n            url: baseUrl + '/auth/register' + cartId     + '?client_secret='  + client_secret + '&client_id=' + client_id,\n            method: \"POST\",\n            data: data,\n        }).then(function(response) {\n            $location.path('/cart');\n            $cookies.put('auth' , JSON.stringify(response.data));\n            Cart.setCartId(response.data.cart_id);\n            $('#sign-up').modal('toggle');\n            location.reload();\n        }).catch(function(response) {\n            var danger = $('.bg-danger');\n            danger.removeClass('hidden');\n            danger.html(\"<ul></ul>\");\n            angular.forEach(response.data , function (value , index) {\n                danger.find(\"ul\").append(\"<li>\" + value + \"</li>\");\n            });\n        }).finally(function() {});  \n    };\n\n    userModel.getAuthStatus = function() {\n        var status = $cookies.get('auth');\n        if (status) {\n            return true;\n        } else {\n            return false;\n        }\n    };\n\n    userModel.getUserObject = function () {\n        var usrObject = angular.fromJson($cookies.get('auth'));\n        return usrObject;\n    };\n\n    userModel.doUserLogout = function () {\n        $cookies.remove('auth');\n    };\n    \n    userModel.doEmail = function (email) {\n        return $http({\n            headers: {\n                'Accept': 'application/json',\n                'Content-Type': 'application/json'\n            },\n            url: baseUrl + '/auth/email/' + email + '/' + Cart.getCartId() + '/?client_secret='  + client_secret + '&client_id=' + client_id,\n            method: \"GET\",\n        }).then(function(response) {\n            $rootScope.carts = response.data.data;\n            $location.path('/profile');\n        }).catch(function(response) {\n            console.log(response);\n        }).finally(function() {});\n    };\n    \n    userModel.getUserId = function () {\n      if (userModel.getUserObject()){\n          return userModel.getUserObject()._id;\n      }else{\n          return Cart.getItems(Cart.getCartId()).data.data.customer.data._id;\n      } \n    };\n   \n    return userModel;\n}]);","myApp.factory(\"Cart\" , [ \"$http\" , \"$rootScope\", function ($http , $rootScope) {\n    var cart = [];\n    cart.getCartId = function () {\n       return localStorage.getItem('cart_id');\n    };\n\n    cart.setCartId = function (cartId) {\n        localStorage.setItem('cart_id' , cartId);\n    };\n\n    cart.getItems = function (cartId) {\n        if (!cartId){\n            return [];\n        }\n        return $http({\n            headers: {\n                'Accept': 'application/json',\n                'Content-Type': 'application/json'\n            },\n            url: baseUrl + '/carts/' + cartId + '/items?client_secret='  + client_secret + '&client_id=' + client_id,\n            method: \"GET\",\n        }).then(function(response) {\n           $rootScope.carts = response.data.data;\n           $rootScope.shopData = $rootScope.carts.shop.data;\n        }).catch(function(response) {\n            console.log(response);\n        }).finally(function() {});\n    };\n\n    cart.deleteItem = function (cartId , item) {\n        return $http({\n            headers: {\n                'Accept': 'application/json',\n                'Content-Type': 'application/json'\n            },\n            url: baseUrl + '/carts/'+ cartId +'/items/'+ item._id + '?client_secret=' + client_secret + '&client_id=' +client_id,\n            method: \"DELETE\",\n        }).then(function(response) {\n            $rootScope.carts = response.data.data;\n        }).catch(function(response) {\n            var index= $rootScope.carts.products.data.indexOf(item);\n            $rootScope.carts.products.data.splice(index,1);\n        }).finally(function() {});\n    };\n\n    cart.updateItem = function (cartId , item) {\n        var data = {\n            'item_id'   : item._id,\n            'quantity'  : item.quantity\n        };\n        return $http({\n            headers: {\n                'Accept': 'application/json',\n                'Content-Type': 'application/json'\n            },\n            url: baseUrl + '/carts/' + cartId + '/items?client_secret=' + client_secret + '&client_id=' +client_id,\n            method: \"POST\",\n            data : data,\n        }).then(function(response) {\n            $rootScope.carts = response.data.data;\n            console.log(response);\n        }).catch(function(response) {\n            $rootScope.carts = response.data.data;\n            $('.updateItem').animate({\n                height: 'toggle'\n            }).removeClass('hidden').find('.alert').text('Lo siento no hay suficiente stock para '+ item.name);\n            setTimeout(function () {\n                $('.updateItem').animate({ height: 'toggle'} , 1000);\n            } , 7000)\n        }).finally(function() {});\n    };\n    return cart;\n}]);","myApp.factory('Coupon' , [\"$http\" , \"Cart\" , \"$rootScope\", function ($http , Cart , $rootScope) {\n    var couponModel = {};\n    couponModel.useCoupon = function (couponId) {\n        return $http({\n            headers: {\n                'Accept': 'application/json',\n                'Content-Type': 'application/json'\n            },\n            url: baseUrl + '/carts/' + Cart.getCartId() + '/coupons/' + couponId + '?client_secret='  + client_secret + '&client_id=' + client_id,\n            method: \"GET\"\n        }).then(function(response) {\n            $('#no-coupon').addClass('hidden');\n            $('#yes-coupon').removeClass('hidden');\n            $rootScope.carts = response.data.data;\n        }).catch(function(response) {\n            $('#no-coupon').removeClass('hidden');\n            $('#yes-coupon').addClass('hidden');\n        }).finally(function() {});\n    };\n    return couponModel;\n}]);","myApp.factory('Email' ,['$http', '$location' , \"$rootScope\" , \"Cart\",  function ($http , $location , $rootScope , Cart) {\n    var emailModel = {};\n    emailModel.doEmail = function (email) {\n        return $http({\n            headers: {\n                'Accept': 'application/json',\n                'Content-Type': 'application/json'\n            },\n            url: baseUrl + '/auth/email/' + email + '/' + Cart.getCartId() + '/?client_secret='  + client_secret + '&client_id=' + client_id,\n            method: \"GET\"\n        }).then(function(response) {\n            $rootScope.carts = response.data.data;\n            $location.path('/profile');\n        }).catch(function(response) {\n            console.log(response);\n        }).finally(function() {});\n    };\n    return emailModel;\n}]);","myApp.factory(\"Profile\" , [\"$http\" , \"$rootScope\" , \"$location\" , function ($http , $rootScope , $location) {\n    var profileModel = [];\n    profileModel.updateData = function (data) {\n        return $http({\n            headers: {\n                'Accept': 'application/json',\n                'Content-Type': 'application/json'\n            },\n            url: baseUrl + '/orders/' + $rootScope.carts.order_id  + '?client_secret='  + client_secret + '&client_id=' + client_id,\n            method: \"PUT\",\n            data : data\n        }).then(function(response) {\n            $rootScope.carts = response.data.data;\n            localStorage.setItem('orderData' , JSON.stringify($rootScope.carts.order.data.client));\n            $location.path('/shipping');\n        }).catch(function(response) {\n            console.log(response);\n        }).finally(function() {});\n    }; \n    profileModel.getData = function () {\n        return localStorage.getItem('orderData');\n    };\n    return profileModel;\n}]);","myApp.factory(\"Shipping\" , [\"$http\" , \"User\", \"$rootScope\" , \"Cart\", \"$location\" ,function ($http , User , $rootScope , Cart , $location) {\n   var address = {};\n\n    address.getAddresses = function () {\n        return $http({\n            headers: {\n                'Accept': 'application/json',\n                'Content-Type': 'application/json'\n            },\n            url: baseUrl + '/carts/'+ Cart.getCartId() +'/customers/' + User.getUserId() + '/addresses?client_secret='  + client_secret + '&client_id=' + client_id,\n            method: \"GET\",\n        }).then(function(response) {\n            $rootScope.addresses = response.data.data;\n        }).catch(function(response) {\n            $rootScope.states = response.data;\n        }).finally(function() {});\n    };\n\n    address.getStates = function () {\n        return $http({\n            headers: {\n                'Accept': 'application/json',\n                'Content-Type': 'application/json'\n            },\n            url: baseUrl + '/states?client_secret='  + client_secret + '&client_id=' + client_id,\n            method: \"GET\",\n        }).then(function(response) {\n            $rootScope.states = response.data.states;\n        }).catch(function(response) {\n            console.log(response);\n        }).finally(function() {});\n    };\n    address.getCities = function (id) {\n        return $http({\n            headers: {\n                'Accept': 'application/json',\n                'Content-Type': 'application/json'\n            },\n            url: baseUrl + '/cities/'+ id +'?client_secret='  + client_secret + '&client_id=' + client_id,\n            method: \"GET\",\n        }).then(function(response) {\n            $rootScope.cities = response.data.cities;\n            $rootScope.defaultCity = response.data.cities[0];\n        }).catch(function(response) {\n            console.log(response);\n        }).finally(function() {});\n    };\n\n    address.create = function (data) {\n        return $http({\n            headers: {\n                'Accept': 'application/json',\n                'Content-Type': 'application/json'\n            },\n            url: baseUrl + '/carts/' + Cart.getCartId() +'/customers/' + User.getUserId()  + '/addresses?client_secret='  + client_secret + '&client_id=' + client_id,\n            method: \"POST\",\n            data : data\n        }).then(function(response) {\n            console.log(response);\n            $rootScope.addresses = response.data.addresses.data;\n            $rootScope.carts = response.data.cart.data;\n        }).catch(function(response) {\n            console.log(response);\n        }).finally(function() {});  \n    };\n     address.getShippingValue = function () {\n        return $http({\n            headers: {\n                'Accept': 'application/json',\n                'Content-Type': 'application/json'\n            },\n            url: baseUrl + '/carts/' + Cart.getCartId() +'/shipping?client_secret='  + client_secret + '&client_id=' + client_id,\n            method: \"GET\"\n        }).then(function(response) {\n            console.log(response);\n            $rootScope.carts = response.data.cart.data;\n        }).catch(function(response) {\n            swal({\n                title: \"Upps!\",\n                text: response.data.message,\n                type: \"error\",\n                confirmButtonText: \"OK\"\n            });\n            $rootScope.carts = response.data.cart.data;\n        }).finally(function() {});\n    };\n\n    address.doShippingMethod = function (data) {\n        return $http({\n            headers: {\n                'Accept': 'application/json',\n                'Content-Type': 'application/json'\n            },\n            url:  baseUrl + '/orders/' + $rootScope.carts.order_id  + '?client_secret='  + client_secret + '&client_id=' + client_id,\n            method: \"PUT\",\n            data : data\n        }).then(function(response) {\n            $rootScope.carts = response.data.data;\n        }).catch(function(response) {\n            console.log(response);\n        }).finally(function() {});\n    };  \n    \n    address.assignShipping = function (data) {\n        return $http({\n            headers: {\n                'Accept': 'application/json',\n                'Content-Type': 'application/json'\n            },\n            url:  baseUrl + '/orders/' + $rootScope.carts.order_id  + '?client_secret='  + client_secret + '&client_id=' + client_id,\n            method: \"PUT\",\n            data : data\n        }).then(function(response) {\n            console.log(response);\n            $rootScope.carts = response.data.data;\n        }).catch(function(response) {\n            console.log(response);\n        }).finally(function() {});\n    };\n\n    return address;\n}]);","myApp.factory('Payment' ,['$http', '$location' , \"$rootScope\" , \"Cart\",  function ($http , $location , $rootScope , Cart) {\n    var paymentModel = {};\n    paymentModel.getPaymentMethod = function () {\n        return $http({\n            headers: {\n                'Accept': 'application/json',\n                'Content-Type': 'application/json'\n            },\n            url: baseUrl + '/payments/?client_secret='  + client_secret + '&client_id=' + client_id,\n            method: \"GET\"\n        }).then(function(response) {\n            $rootScope.payment_methods = response.data.data;\n        }).catch(function(response) {\n            console.log(response);\n        }).finally(function() {});\n    };  \n    \n    paymentModel.doPayment = function (method) {\n        return $http({\n            headers: {\n                'Accept': 'application/json',\n                'Content-Type': 'application/json'\n            },\n            url: baseUrl + '/payments' +  method + '/carts/' + Cart.getCartId()  + '?client_secret='  + client_secret + '&client_id=' + client_id,\n            method: \"GET\"\n        }).then(function(response) {\n            $('#'+ method.replace('/','')).attr('disabled' , false);\n            $('#'+ method.replace('/','')).text(\"Pagar Ahora\");\n            if (response.data.url){\n                $MPC.openCheckout({\n                    url: response.data.url,\n                    mode: \"modal\",\n                    onreturn: function(data) {\n                        $location.reload();\n                    }\n                });\n            }\n        }).catch(function(response) {\n            console.log(response);\n        }).finally(function() {});\n    };\n\n    return paymentModel;\n}]);"]}